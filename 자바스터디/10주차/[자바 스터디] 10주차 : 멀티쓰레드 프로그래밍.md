![](images/â˜•ï¸_[ìë°”_ìŠ¤í„°ë””]_10ì£¼ì°¨_në©€í‹°ì“°ë ˆë“œ_í”„ë¡œê·¸ë˜ë°.png)

## Processì™€ Thread
![](images/í”„ë¡œì„¸ìŠ¤_ì“°ë ˆë“œ.jpeg)
[ì¶œì²˜ - https://gyoogle.dev/blog/computer-science/operating-system/Process%20vs%20Thread.html]

### Process
* ë©”ëª¨ë¦¬ì—ì„œ ì‹¤í–‰ë˜ëŠ” í”„ë¡œê·¸ë¨
  * ë©”ì¸ ì“°ë ˆë“œ í¬í•¨ ìµœì†Œ 1ê°œì˜ ì“°ë ˆë“œë¥¼ ê°–ëŠ”ë‹¤
* í”„ë¡œì„¸ìŠ¤ëŠ” ê°ê° ë³„ë„ì˜ ì£¼ì†Œ ê³µê°„ì— í• ë‹¹ëœë‹¤ (ë…ë¦½ì )
### Thread
* í”„ë¡œì„¸ìŠ¤ ì•ˆì—ì„œ ì‹¤í–‰ë˜ëŠ” ì—¬ëŸ¬ **íë¦„ ë‹¨ìœ„**
  * í•˜ë‚˜ì˜ í”„ë¡œì„¸ìŠ¤ ì•ˆì— ì—¬ëŸ¬ ì“°ë ˆë“œë¥¼ êµ¬ì„±í•´ ê° ì“°ë ˆë“œê°€ ê°ê°ì˜ ì‘ì—…ì„ ë§¡ì•„ì„œ ì²˜ë¦¬
  * ì“°ë ˆë“œê°€ ìˆì–´ **ë‹¤ìˆ˜ì˜ ì‘ì—…ì„ ë™ì‹œì— ì²˜ë¦¬**í•  ìˆ˜ ìˆë‹¤
* ì“°ë ˆë“œëŠ” `Stack` ë§Œ ë³„ë„ë¡œ í• ë‹¹ ë°›ê³  ë‚˜ë¨¸ì§€ ì˜ì—­ì€ í”„ë¡œì„¸ìŠ¤ì˜ ê²ƒì„ ì„œë¡œ ê³µìœ í•œë‹¤
  * Context Switchingì— ë“¤ì–´ê°€ëŠ” ì˜¤ë²„í—¤ë“œê°€ ì ì–´ ê°ê°ì„ ë³„ë„ì˜ í”„ë¡œì„¸ìŠ¤ë¡œ êµ¬ì„±í•˜ëŠ” ê²ƒë³´ë‹¤ ì„±ëŠ¥ì´ ì¢‹ë‹¤
  * ì „ì—­, ì •ì  ë³€ìˆ˜ë¥¼ ì‰½ê²Œ ê³µìœ í•  ìˆ˜ ìˆë‹¤

## Thread í´ë˜ìŠ¤ì™€ Runnable ì¸í„°í˜ì´ìŠ¤
* `Thread` í´ë˜ìŠ¤ëŠ” `Runnable` ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œë‹¤
  * `Runnable` ì¸í„°í˜ì´ìŠ¤ëŠ” `run()` ë©”ì†Œë“œ í•˜ë‚˜ë§Œ ê°–ëŠ” í•¨ìˆ˜í˜•ì¸í„°í˜ì´ìŠ¤ì´ë‹¤.
  * `Thread` í´ë˜ìŠ¤ëŠ” `run()` ë©”ì†Œë“œ ì´ì™¸ì— `start()` ì™€ ê°™ì€ ì¶”ê°€ì ì¸ ë©”ì†Œë“œ / ë³€ìˆ˜ë¥¼ ê°–ëŠ”ë‹¤
```java
@FunctionalInterface
public interface Runnable {
    public abstract void run();
}

---

public class Thread implements Runnable {
    ...
}
```
### ì“°ë ˆë“œ í´ë˜ìŠ¤ ìƒì„±
#### `extends Thread` vs `implements Runnable`
* ì“°ë ˆë“œ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ê¸° ìœ„í•´ì„œëŠ” ë‘˜ ì¤‘ ì•„ë¬´ê±°ë‚˜ ìƒì†ë°›ì•„ ì‚¬ìš©í•˜ë©´ ë˜ëŠ”ë°, `Runnable` ì¸í„°í˜ì´ìŠ¤ë¥¼ ìƒì†ë°›ì•„ êµ¬í˜„í•˜ê²Œ ë˜ë©´ **ë‹¤ë¥¸ í´ë˜ìŠ¤ë¥¼ ìƒì†ë°›ê±°ë‚˜ ë‹¤ë¥¸ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ë©´ì„œ** ë™ì‹œì— ì“°ë ˆë“œë¥¼ ë§Œë“¤ ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ì´ëŸ´ ê²½ìš°ì— ì‚¬ìš©í•  ìˆ˜ ìˆì„ ê²ƒ ê°™ë‹¤.
* ë˜, Thread í´ë˜ìŠ¤ëŠ” `run()` ì™¸ì—ë„ ì—¬ëŸ¬ê°€ì§€ ë©”ì†Œë“œë¥¼ ì œê³µí•˜ë¯€ë¡œ ì´ ì¤‘ ì˜¤ë²„ë¼ì´ë“œ í•´ì•¼ ë  ë©”ì†Œë“œê°€ ìˆë‹¤ë©´ Threadë¥¼ ìƒì†ë°›ì•„ ì¬ì •ì˜í•˜ê³ , ì•„ë‹ˆë¼ë©´ ë”± `run()` ë§Œ ì„ ì–¸ë˜ì–´ ìˆëŠ” Runnable ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ëŠ”ê²Œ ì¢‹ë‹¤.
#### Thread í´ë˜ìŠ¤ ì‚¬ìš©
```java
public class MyThread extends Thread {
    @Override
    public void run() {
        System.out.println("ì“°ë ˆë“œ ì‹¤í–‰");
    }
}

---

MyThread myThread = new MyThread();
myThread.start(); // "ì“°ë ˆë“œ ì‹¤í–‰"
```
#### Runnable ì¸í„°í˜ì´ìŠ¤ ì‚¬ìš©
```java
public class MyThread implements Runnable {
    @Override
    public void run() {
        System.out.println("ì“°ë ˆë“œ ì‹¤í–‰");
    }
}

---

MyThread myThread = new MyThread();
// Runnable ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ ê²½ìš°, Thread í´ë˜ìŠ¤ë¥¼ í†µí•´ ì“°ë ˆë“œë¥¼ ì‹¤í–‰ì‹œí‚¬ ìˆ˜ ìˆë‹¤
new Thread(myThread).start(); // "ì“°ë ˆë“œ ì‹¤í–‰"
```
* `Runnable` ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„ ì‹œ ì•„ë˜ì™€ ê°™ì´ë„ ê°€ëŠ¥
```java
public class MyThread extends ParentClass implements Runnable, AnotherInterface {
    @Override
    public void run() {
        System.out.println("ì“°ë ˆë“œ ì‹¤í–‰");
    }

    ...
}
```

## ì“°ë ˆë“œì˜ ìƒíƒœ
* ì“°ë ˆë“œì˜ ìƒíƒœëŠ” `getState()`ë¥¼ í†µí•´ í™•ì¸í•  ìˆ˜ ìˆë‹¤

![](images/ì“°ë ˆë“œ_ìƒíƒœ.png)
[ì¶œì²˜ : https://crunchify.com/java-thread-state-introduction-with-example/]
### New
* ì“°ë ˆë“œ í´ë˜ìŠ¤ê°€ ìƒì„±ëœ ì´ˆê¸° ìƒíƒœ
### Runnable
* `start()` ë©”ì„œë“œë¥¼ í˜¸ì¶œí•œ ì§í›„ ìƒíƒœ
* ë§ ê·¸ëŒ€ë¡œ ì‹¤í–‰ì´ **ê°€ëŠ¥í•œ** ìƒíƒœ
  * ì“°ë ˆë“œ ìŠ¤ì¼€ì¥´ë§ì„ í†µí•´ ì—¬ëŸ¬ ì“°ë ˆë“œê°€ CPUë¥¼ (ê³„ì†í•´ì„œ) ë²ˆê°ˆì•„ê°€ë©´ì„œ ì ìœ í•˜ê³  run() ë©”ì†Œë“œë¥¼ ì‹¤í–‰í•´ë‚˜ê°„ë‹¤.
  * ì´ë¥¼ `Running` ìƒíƒœë¼ í•œë‹¤
* ì¦‰, ì“°ë ˆë“œëŠ” ìŠ¤ì¼€ì¥´ë§ ë°©ì‹ì— ë”°ë¼ `Runnable` ê³¼ `Running` ìƒíƒœë¥¼ ì˜¤ê°€ë©° ì‹¤í–‰ëœë‹¤

### Timed Waiting, Waiting
* ì¼ì‹œ ì •ì§€ ìƒíƒœ
  * ì¼ì‹œ ì •ì§€ëŠ” ì‹¤í–‰ ëŒ€ê¸° (`Runnable`) ìƒíƒœì™€ ë‹¤ë¥´ë‹¤. **ì‹¤í–‰ì´ ë¶ˆê°€ëŠ¥**í•œ ìƒíƒœë¥¼ ë§í•œë‹¤
* ì‹¤í–‰ ì¤‘ì¸ ì“°ë ˆë“œì— `wait()`, `sleep()` ë“±ì˜ ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ë©´ `(Timed)Waiting` ìƒíƒœê°€ ëœë‹¤
  * `notify()`, `notifyAll()` ë©”ì†Œë“œ ë“±ì„ í†µí•´ ë‹¤ì‹œ `Runnable` ìƒíƒœê°€ ë  ìˆ˜ ìˆë‹¤
* Timedì¸ ê²ƒê³¼ ì•„ë‹Œ ê²ƒì˜ ì°¨ì´ëŠ” `wait()` ë©”ì†Œë“œì—ì„œ ì¸ìë¥¼ ì§€ì •í•´ì£¼ì—ˆëŠ”ì§€ì— ë”°ë¼ ë‹¬ë¼ì§„ë‹¤.

### Blocked
* ë½ì´ ê±¸ë¦° ìƒíƒœ. `ëª¨ë‹ˆí„° ë½(monitor lock)`ì´ í’€ë¦¬ê¸°ë¥¼ ê¸°ë‹¤ë¦¬ëŠ” ìƒíƒœ.
* `synchronized` ë¸”ëŸ­ì´ë‚˜ ë©”ì†Œë“œì— ë“¤ì–´ê°€ê¸°ë¥¼ ê¸°ë‹¤ë¦¬ëŠ” ìƒíƒœì´ë‹¤

### Terminated
* ì“°ë ˆë“œê°€ ì¢…ë£Œëœ ìƒíƒœ

## ì“°ë ˆë“œê°€ ì œê³µí•˜ëŠ” ë©”ì„œë“œ
### join()
* í•´ë‹¹ ì“°ë ˆë“œê°€ ì¢…ë£Œë  ë•Œ ê¹Œì§€ ëŒ€ê¸°í•œë‹¤
  * ë‚´ë¶€ì ìœ¼ë¡œëŠ” `Object.wait()` ì„ í˜¸ì¶œí•œë‹¤.
  * ì¸ìì— ë°€ë¦¬ì´ˆë¥¼ ë„£ìœ¼ë©´ ìµœëŒ€ ê·¸ ì‹œê°„ë§Œí¼ë§Œ ëŒ€ê¸°í•œë‹¤
```java
// 1. join()ì„ ì‚¬ìš©í•œ ê²½ìš°
public static void main(String[] args) throws InterruptedException {
    Thread thread = new Thread(() -> {
        try {
            sleep(3000);
            System.out.println(Thread.currentThread().getName());
        } catch (InterruptedException e) {
            throw new RuntimeException(e);
        }
    });

    thread.start();
    thread.join();
    
    System.out.println(Thread.currentThread().getName());
}
/* 
 * ì¶œë ¥ ê²°ê³¼
 * Thread-0
 * main
 */

// 2. join()ì„ ì‚¬ìš©í•˜ì§€ ì•Šì€ ê²½ìš°
public static void main(String[] args) throws InterruptedException {
    Thread thread = new Thread(() -> {
        try {
            sleep(3000);
            System.out.println(Thread.currentThread().getName());
        } catch (InterruptedException e) {
            throw new RuntimeException(e);
        }
    });

    thread.start();
    // thread.join();
    
    System.out.println(Thread.currentThread().getName());
}
/* 
 * ì¶œë ¥ ê²°ê³¼ (Thread-0ê°€ sleep()í•˜ëŠ” ë™ì•ˆ ë©”ì¸ ì“°ë ˆë“œê°€ ë™ì‘í•œë‹¤)
 * main
 * Thread-0
 */
```

* ì—¬ëŸ¬ ì“°ë ˆë“œê°€ ì‘ë™í•˜ê³  ìˆë”ë¼ë„ ë‚˜ë¨¸ì§€ ì“°ë ˆë“œë¥¼ ëª¨ë‘ ì¢…ë£Œì‹œí‚¤ëŠ”ê°€?
```java

```
### interrupt() vs stop()


### currentThread()

### ?

## ì“°ë ˆë“œì˜ ìš°ì„ ìˆœìœ„
* ì“°ë ˆë“œëŠ” ìš°ì„ ìˆœìœ„ì— ëŒ€í•œ í•„ë“œë¥¼ ê°–ëŠ”ë‹¤
```java
public class Thread implements Runnable {
    ...
    private int priority;
    ...

    // setPriority() ë©”ì„œë“œë¡œ ìš°ì„ ìˆœìœ„ë¥¼ ì„¤ì •í•  ìˆ˜ ìˆë‹¤
    public final void setPriority(int newPriority) {
        ...
    }
}
```
* ìš°ì„ ìˆœìœ„ëŠ” `1-10` ì‚¬ì´ì˜ ê°’ì„ ê°–ëŠ”ë‹¤
* ì“°ë ˆë“œ í´ë˜ìŠ¤ëŠ” `1`, `5`, `10` ìš°ì„ ìˆœìœ„ë¥¼ ìƒìˆ˜ë¡œ ì •ì˜í•˜ê³  ìˆë‹¤
```java
    // ìµœì†Œ ìš°ì„ ìˆœìœ„
    public static final int MIN_PRIORITY = 1;

    // ì•„ë¬´ëŸ° ì„¤ì •ì„ í•˜ì§€ ì•Šì•˜ì„ ë•Œ **ê¸°ë³¸** ìš°ì„ ìˆœìœ„
    public static final int NORM_PRIORITY = 5;

    // ìµœëŒ€ ìš°ì„ ìˆœìœ„
    public static final int MAX_PRIORITY = 10;
```
* ë‹¤ë§Œ, ìš°ì„ ìˆœìœ„ê°€ në°° ë†’ë‹¤ê³  í•´ì„œ ë¬´ì¡°ê±´ në°° ë¹¨ë¦¬/ë§ì´ ì‹¤í–‰ë˜ëŠ” ê²ƒì€ ì•„ë‹ˆë‹¤
  * ìš°ì„ ìˆœìœ„ê°€ ë†’ì€ ì“°ë ˆë“œëŠ” ë‚®ì€ ì“°ë ˆë“œë³´ë‹¤ ì¢€ ë” ë§ì´ `ì‹¤í–‰ í`ì— í¬í•¨ë˜ì–´, ì¢€ ë” ë§ì€ ì‘ì—… ì‹œê°„ì„ í• ë‹¹ë°›ì„ ë¿ì´ë‹¤.
#### ìš°ì„ ìˆœìœ„ ì˜ˆì‹œ
```java
public class MyThread extends Thread {

    public MyThread(String name) {
        super(name);
    }

    @Override
    public void run() {
        for (int i = 0; i < 5; i++) {
            System.out.print(Thread.currentThread().getName() + " ");
            try {
                sleep(10);
            } catch (InterruptedException e) {
                throw new RuntimeException(e);
            }
        }
    }

    public static void main(String[] args) {
        MyThread myThread1 = new MyThread("1");
        myThread1.setPriority(1);
        MyThread myThread2 = new MyThread("2");
        myThread2.setPriority(1);
        MyThread myThread3 = new MyThread("3");
        myThread3.setPriority(10);
        MyThread myThread4 = new MyThread("4");
        myThread4.setPriority(10);

        myThread1.start();
        myThread2.start();
        myThread3.start();
        myThread4.start();
    }
}
```
#### ì¶œë ¥ ê²°ê³¼
```java
1 4 2 3 1 3 2 4 1 3 4 2 1 4 3 2 1 3 4 2 
```
* ë¬´ì¡°ê±´ ìš°ì„ ìˆœìœ„ê°€ ë†’ì€ ì“°ë ˆë“œê°€ ë¨¼ì €/ë§ì´ ì‹¤í–‰ë˜ëŠ”ê²Œ ì•„ë‹ˆë¼ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤
  * ë˜í•œ, ë¬¼ë¦¬ì ì¸ cpu ì½”ì–´ ìˆ˜ê°€ ë§ìœ¼ë©´ í•´ë‹¹ ì½”ì–´ ìˆ˜ ë§Œí¼ ë³‘ë ¬ë¡œ ì“°ë ˆë“œê°€ ì‹¤í–‰ê°€ëŠ¥í•˜ê¸° ë•Œë¬¸ì—, ê·¸ ì´ìƒì˜ ì“°ë ˆë“œê°€ ì‹¤í–‰ ëŒ€ê¸° ì¤‘ì´ì–´ì•¼ ìš°ì„ ìˆœìœ„ê°€ ì˜ë¯¸ê°€ ìˆê¸°ë„ í•˜ë‹¤.

## Main ì“°ë ˆë“œ
* ìë°”ëŠ” JVM ìœ„ì—ì„œ ëŒì•„ê°„ë‹¤
  * ì´ê²Œ í•˜ë‚˜ì˜ **í”„ë¡œì„¸ìŠ¤** ì´ê³ , ì´ í”„ë¡œì„¸ìŠ¤ë¥¼ **ì‹¤í–‰**í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ `main()` ë©”ì†Œë“œ ì´ë‹¤
  * ì§€ê¸ˆê» ì•„ë¬´ìƒê°ì—†ì´ í”„ë¡œê·¸ë¨ì„ ì‹¤í–‰í•˜ê¸° ìœ„í•´ ì‘ì„±í–ˆë˜ ë©”ì¸ ë©”ì†Œë“œê°€ **ë©”ì¸ ì“°ë ˆë“œ** ë¥¼ ì‹¤í–‰ì‹œì¼œ í”„ë¡œì„¸ìŠ¤ë¥¼ ì‘ë™í•˜ë„ë¡ ë§Œë“¤ì—ˆë˜ ê²ƒì´ë‹¤.
```java
// ë©”ì¸ ì“°ë ˆë“œ ì‹¤í–‰
public static void main (String[] args) {
    ...
}
```
* ë³„ë„ë¡œ ë‹¤ë¥¸ ì“°ë ˆë“œë¥¼ ì‹¤í–‰í•˜ì§€ ì•Šê³  `main()` ë©”ì†Œë“œë§Œ ì‹¤í–‰í•˜ëŠ” ê²ƒì„ **ì‹±ê¸€ì“°ë ˆë“œ ì• í”Œë¦¬ì¼€ì´ì…˜** ì´ë¼ í•œë‹¤
* (ì‚¬ì§„)
### ë©€í‹°ì“°ë ˆë“œ ì• í”Œë¦¬ì¼€ì´ì…˜
* `main()` ë©”ì†Œë“œë¡œ ì‹¤í–‰ëœ ë©”ì¸ ì“°ë ˆë“œ ì•ˆì—ì„œ ì¶”ê°€ë¡œ ì“°ë ˆë“œë¥¼ ìƒì„±í•˜ì—¬ ì‹¤í–‰í•˜ëŠ” ê²ƒì„ **ë©€í‹° ì“°ë ˆë“œ ì• í”Œë¦¬ì¼€ì´ì…˜** ì´ë¼ê³  í•œë‹¤.
* (ì‚¬ì§„)
### ë°ëª¬(Daemon) ì“°ë ˆë“œ
* ë©”ì¸ ì“°ë ˆë“œì˜ ì‘ì—…ì„ ë•ëŠ” **ë³´ì¡°ì ì¸ ì—­í• **ì„ í•˜ëŠ” ì“°ë ˆë“œ
  * ë”°ë¼ì„œ, ë©”ì¸ ì“°ë ˆë“œê°€ ì¢…ë£Œë˜ë©´ ë°ëª¬ ì“°ë ˆë“œëŠ” ê°•ì œë¡œ ì¢…ë£Œëœë‹¤
* ì£¼ ì“°ë ˆë“œ ì‹¤í–‰ ì¤‘ì— ë°ëª¬ ì“°ë ˆë“œë¡œ ë§Œë“¤ ì“°ë ˆë“œì˜ `.setDaemon(true)`ë¥¼ í˜¸ì¶œí•˜ë©´ í˜¸ì¶œë‹¹í•œ ì“°ë ˆë“œëŠ” ë°ëª¬ì´ ëœë‹¤
```java
public static void main() {
    // ì£¼ ì“°ë ˆë“œ ì‹¤í–‰ ì¤‘
    MyThread myThread = new MyThread();
    myThread.setDaemon(true); // myThreadê°€ ë©”ì¸ ì“°ë ˆë“œ (ì£¼ ì“°ë ˆë“œ) ì˜ ë°ëª¬ ì“°ë ˆë“œê°€ ë¨
    myThread.start(); // ë°ëª¬ ì“°ë ˆë“œëŠ” ë©”ì¸ ë©”ì†Œë“œ(ì“°ë ˆë“œ)ê°€ ì¢…ë£Œë˜ë©´ ìë™ìœ¼ë¡œ ì¢…ë£Œë¨
}
```
* ì¦‰, ìœ„ ìƒí™©ì—ì„œëŠ” ë©”ì¸ ë©”ì†Œë“œì—ì„œ ì•„ë¬´ëŸ° ì‘ì—…ë„ í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ë°ëª¬ ì“°ë ˆë“œê°€ ì‹¤í–‰ë˜ì—ˆìŒì—ë„ ë°”ë¡œ í”„ë¡œì„¸ìŠ¤ê°€ ì¢…ë£Œë˜ì–´ ë²„ë¦°ë‹¤
* ë°ëª¬ ì“°ë ˆë“œëŠ” ì£¼ ì“°ë ˆë“œë¥¼ ëª¨ë‹ˆí„°ë§ í•˜ëŠ” ë“±ì˜ ë¶€ê°€ì ì¸ ì‘ì—… ìˆ˜í–‰ ìš©ë„ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

## ë™ê¸°í™”
* **ì—¬ëŸ¬ ì“°ë ˆë“œê°€ í•˜ë‚˜ì˜ ìì›ì„ ì‚¬ìš©**í•˜ë ¤í•  ë•Œ í˜„ì¬ í•´ë‹¹ ìì›ì„ ì‚¬ìš©í•˜ëŠ” í•˜ë‚˜ì˜ ì“°ë ˆë“œë¥¼ ì œì™¸í•œ ë‚˜ë¨¸ì§€ ì“°ë ˆë“œì˜ ì ‘ê·¼ì„ ë§‰ëŠ” ê²ƒ
  * ì´ë ‡ê²Œ ë‹¤ë¥¸ ì“°ë ˆë“œì˜ ì ‘ê·¼ì„ ë§‰ëŠ” ê²ƒì„ `Thread-Safe` í•˜ë‹¤ê³  ë§í•œë‹¤
* ìë°”ì—ì„œ ë™ê¸°í™”ë¥¼ êµ¬í˜„í•˜ëŠ” ë°©ë²•ì€ 3ê°€ì§€ë¡œ ë¶„ë¥˜ëœë‹¤
  1. synchronized í‚¤ì›Œë“œ
  2. Atomic í´ë˜ìŠ¤
  3. volatile í‚¤ì›Œë“œ

### synchronized í‚¤ì›Œë“œ
* `synchronized` ëŠ” ë©”ì†Œë“œì— ë¶™ì—¬ ì‚¬ìš©í•˜ëŠ” `synchronized methods` ë°©ì‹ê³¼ ë¸”ëŸ­ ì•ì— ë¶™ì—¬ ì‚¬ìš©í•˜ëŠ” `synchronized statements` ë°©ì‹ì´ ìˆë‹¤.
#### 1. synchronized methods
* ë¨¼ì € ë©”ì„œë“œì— ë¶™ì—¬ ì‚¬ìš©í•˜ëŠ” `synchronized methods` ë°©ì‹ì´ë‹¤
#### 1-1. `synchronized` í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì€ ê²½ìš°
```java
public class Counter {
    private static Counter instance = null;

    private int c = 0;

    private Counter() {
    }

    public static Counter getInstance() {
        if (instance == null) {
            instance = new Counter();
        }
        return instance;
    }

    public void increment() {
        c++;
        try {
            sleep(100);
        } catch (InterruptedException e) {
            throw new RuntimeException(e);
        }
    }

    public int value() {
        return c;
    }

    static class MyThread extends Thread {

        public MyThread(String name) {
            super(name);
        }

        @Override
        public void run() {
            Counter counter = Counter.getInstance();
            counter.increment();

            System.out.println(super.getName() + " : " + counter.value());
        }
    }

    public static void main(String[] args) {
        MyThread first = new MyThread("first");
        MyThread second = new MyThread("second");

        first.start();
        second.start();
    }

}
```
* ì¶œë ¥ ê²°ê³¼
```java
first : 2
second : 2
```
* ì²«ë²ˆì§¸ ì“°ë ˆë“œì—ì„œ 1ì„ ì¦ê°€ì‹œí‚¤ê³  ê°’ì„ ì¶œë ¥í•˜ê¸° ì „ì— ë‘ë²ˆì§¸ ì“°ë ˆë“œì—ì„œ `Counter` ì¸ìŠ¤í„´ìŠ¤ì˜ `c`ë¥¼ ì¦ê°€ì‹œì¼œì„œ ë‘ ì“°ë ˆë“œ ëª¨ë‘ `2`ë¼ëŠ” ê°’ì„ ì¶œë ¥í•˜ëŠ” ë¬¸ì œê°€ ë°œìƒí•˜ê³  ìˆë‹¤
  * ì´ëŠ” ì›¹ ì•±ì´ ì‹±ê¸€í†¤ ë¹ˆ + ë©€í‹° ì“°ë ˆë“œë¡œ ì‹¤í–‰ë  ë•Œ ì‹¬ê°í•œ ë²„ê·¸ë¥¼ ë§Œë“¤ì–´ë‚¼ ìˆ˜ ìˆë‹¤
#### 1-2. `synchronized` í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•œ ê²½ìš°
* ì´ë¥¼ `synchronized` í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•´ í•´ê²°í•  ìˆ˜ ìˆë‹¤
  * ê¸°ì¡´ `increment()` ë©”ì†Œë“œì— `synchronized` í‚¤ì›Œë“œë¥¼ ë¶™ì—¬ë³´ì
```java
public synchronized void increment() {
    c++;
    try {
        sleep(100);
    } catch (InterruptedException e) {
        throw new RuntimeException(e);
    }
}
```
* ì¶œë ¥ ê²°ê³¼
```java
first : 1
second : 2
```
* ì˜ë„í•œ ëŒ€ë¡œ ê²°ê³¼ê°€ ë‚˜ì˜¤ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤
* `increment()` ì—ì„œ `sleep()` ì´ ìˆ˜í–‰ë˜ëŠ” ë™ì•ˆ ë‹¤ë¥¸ ì“°ë ˆë“œê°€ í•´ë‹¹ ë©”ì„œë“œì— ì ‘ê·¼í•  ìˆ˜ ì—†ê¸° ë–„ë¬¸ì— ë¬¸ì œê°€ ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤
> ìœ„ ì˜ˆì œê°€ ì´ë¡ ì ìœ¼ë¡œ ì™„ë²½í•œ ì˜ˆì œëŠ” ì•„ë‹ ìˆ˜ ìˆìœ¼ë‚˜ synchronized í‚¤ì›Œë“œì˜ ê°œë…ì„ ì´í•´í•˜ê¸°ì— ì‰¬ìš´ ì˜ˆì œë¼ê³  ìƒê°í–ˆë‹¤

#### 2. synchronized statements
[ë‚˜ì¤‘ì— ì •ë¦¬í•˜ê¸´ í•  ê±´ë°.. ì¼ë‹¨ ì—¬ê¸° ê¸€ì— ì •ë¦¬ê°€ ì˜ ë˜ì–´ ìˆìë‹ˆë‹¤ğŸ¥²](https://jgrammer.tistory.com/entry/Java-%ED%98%BC%EB%8F%99%EB%90%98%EB%8A%94-synchronized-%EB%8F%99%EA%B8%B0%ED%99%94-%EC%A0%95%EB%A6%AC)

### volatile
* ìë°” ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ë™ì•ˆ ì„±ëŠ¥ í–¥ìƒì„ ìœ„í•´ ë³€ìˆ˜ë¥¼ `ë©”ì¸ ë©”ëª¨ë¦¬`ì— ì €ì¥í•˜ì§€ ì•Šê³  `CPU Cache` ì— ì €ì¥í•œë‹¤
  * ë©€í‹° ì“°ë ˆë“œ í™˜ê²½ì—ì„œëŠ” ì“°ë ˆë“œê°€ ë³€ìˆ˜ì˜ ê°’ì„ ì½ì–´ì˜¬ ë•Œ ê° ì“°ë ˆë“œì˜ `CPU Cache`ì— ì €ì¥ëœ ê°’ì´ ë‹¬ë¼ ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤
  * `volatile` í‚¤ì›Œë“œë¥¼ ë¶™ì¸ ë³€ìˆ˜ëŠ” ë§¤ë²ˆ `ë©”ì¸ ë©”ëª¨ë¦¬`ì— ê°’ì„ ì €ì¥í•˜ê³  ë¶ˆëŸ¬ì˜¨ë‹¤

![](images/volatile.png)
[ì¶œì²˜ : https://sujl95.tistory.com/63]

#### ë¬¸ì œ ìƒí™© ì˜ˆì‹œ
* `value` ë¼ëŠ” ì¸ìŠ¤í„´ìŠ¤ ë³€ìˆ˜ë¥¼ ê°–ëŠ” `Counter` í´ë˜ìŠ¤ê°€ ìˆë‹¤ê³  í•˜ì
  * `Thread-1`ì€ `value` ê°’ì„ ë”í•˜ê³  ì½ëŠ” ì—°ì‚°ì„ í•œë‹¤
  * `Thread-2`ëŠ” `value` ê°’ì„ ì½ê¸°ë§Œ í•œë‹¤
```java
public class Counter {
    public int value = 0;
}
```

* `Thread-1`ì—ì„œ `value` ê°’ì„ ì¦ê°€ì‹œì¼œë„ ìì‹ ì˜ `CPU Cache` ì—ë§Œ ë°˜ì˜ì´ ë˜ê¸° ë•Œë¬¸ì— `Thread-2`ì—ì„œëŠ” ê³„ì†í•´ì„œ ì—…ë°ì´íŠ¸ë˜ì§€ ì•Šì€ ê°’ì„ ì½ì–´ì˜¤ê²Œ ëœë‹¤.
  * ë‹¤ë¥¸ ì“°ë ˆë“œì— ì˜í•´ ë³€ê²½ëœ ê°’ì´ `ë©”ì¸ ë©”ëª¨ë¦¬`ì— ê¸°ë¡ë˜ì§€ ì•Šì•„ ìµœì‹  ê°’ì„ ì–»ì§€ ëª»í•˜ëŠ” ë¬¸ì œë¥¼ **ê°€ì‹œì„±** ë¬¸ì œë¼ê³  í•œë‹¤

#### ë¬¸ì œ í•´ê²° (volatile í‚¤ì›Œë“œ ì‚¬ìš©)
* ì•„ë˜ì™€ ê°™ì´ `volatile` í‚¤ì›Œë“œë¥¼ ë¶™ì—¬ì£¼ë©´ í•­ìƒ `ë©”ì¸ ë©”ëª¨ë¦¬`ì— ê°’ì„ ì €ì¥í•˜ê³  ë¶ˆëŸ¬ì˜¤ê¸° ë–„ë¬¸ì— ê°€ì‹œì„± ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆë‹¤.
```java
public class Counter {
    public volatile int value = 0;
}
```
* ë‹¹ì—°íˆ `CPU Cache`ì— ì½ê³  ì“°ëŠ” ê²ƒë³´ë‹¤ ë” ë§ì€ ìì›ì´ ì†Œëª¨ë˜ë¯€ë¡œ ë©€í‹° ì“°ë ˆë“œ í™˜ê²½ì—ì„œ ë³€ìˆ˜ì˜ ê°’ ì¼ì¹˜ë¥¼ ë°˜ë“œì‹œ ë³´ì¥í•´ì•¼í•˜ëŠ” ìƒí™©ì—ë§Œ ì‚¬ìš©

### Atomic í´ë˜ìŠ¤
* `synchronized`ì™€ ë‹¬ë¦¬ `non-blocking`í•˜ë©´ì„œ ë™ê¸°í™” ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆëŠ” ë°©ë²•
  * `CAS(Compared and Swap)` ì•Œê³ ë¦¬ì¦˜ì„ ì‚¬ìš©í•œë‹¤
#### CAS ì•Œê³ ë¦¬ì¦˜
![](images/atomic.png)
[ì¶œì²˜ : https://sujl95.tistory.com/63]
* í˜„ì¬ ì“°ë ˆë“œê°€ ê°€ì§€ê³  ìˆëŠ” (ì•Œê³  ìˆëŠ”) ë°ì´í„°ì™€ ì‹¤ì œ ë©”ëª¨ë¦¬ì— ì €ì¥ëœ ë°ì´í„°ë¥¼ ë¹„êµí•´ì„œ ë‘ ê°’ì´ ì¼ì¹˜í•  ë•Œë§Œ ê°’ì„ ì—…ë°ì´íŠ¸í•œë‹¤.
  * `synchronized`ëŠ” ë‘ ì“°ë ˆë“œ ì´ìƒì´ ë™ì‹œì— ê³µìœ  ìì›ì— ì ‘ê·¼í•˜ë ¤í•  ë•Œ `lock`ì„ ê°€ì§„ ì“°ë ˆë“œë§Œ ì ‘ê·¼ì´ ê°€ëŠ¥í•˜ë„ë¡ ë§‰ëŠ”ë‹¤
  * ë°˜ë©´, `Atomic` í´ë˜ìŠ¤ì˜ `CAS` ì•Œê³ ë¦¬ì¦˜ì€ ê°’ì„ ìˆ˜ì •í•˜ë ¤ê³  ì‹œë„í•˜ëŠ” ì“°ë ˆë“œê°€ í˜„ì¬ ë©”ì¸ ë©”ëª¨ë¦¬ì— ì €ì¥ëœ **ì •í™•í•œ** ê°’ì„ ì•Œê³  ìˆì„ ë•Œë§Œ ì—…ë°ì´íŠ¸ë¥¼ í—ˆìš©í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ë™ê¸°í™” ë¬¸ì œë¥¼ í•´ê²°í•œë‹¤.
#### ì£¼ìš” ë©”ì†Œë“œ
* `get()` - í˜„ì¬ ê°’ì„ ë°˜í™˜
* `set(newValue)` - `newValue`ë¡œ ê°’ì„ ì—…ë°ì´íŠ¸
* `getAndSet(new Value)` `newValue`ë¡œ ê°’ì„ ì—…ë°ì´íŠ¸í•˜ê³  ê¸°ì¡´ ê°’ì„ ë°˜í™˜
* `compareAndSet(expect, update)`
  1. í˜„ì¬ ë©”ëª¨ë¦¬ì˜ ê°’ì´ `expect`ì™€ ê°™ë‹¤ë©´ `update`ë¡œ ê°’ì„ ì—…ë°ì´íŠ¸í•˜ê³  `true` ë°˜í™˜
  2. í˜„ì¬ ë©”ëª¨ë¦¬ì˜ ê°’ì´ `expect`ì™€ ë‹¤ë¥´ë‹¤ë©´ ì—…ë°ì´íŠ¸í•˜ì§€ ì•Šê³  `false` ë°˜í™˜

## ë°ë“œë½
* êµì±¡ìƒíƒœ, ë‘˜ ì´ìƒì˜ ì“°ë ˆë“œê°€ ê³µìœ  ìì›ì— ì ‘ê·¼í•˜ê¸° ìœ„í•œ `lock`ì„ íšë“í•˜ë ¤ê³  ëŒ€ê¸°í•˜ë‹¤ê°€ í•´ë‹¹ `lock`ì„ ì¡ê³  ìˆëŠ” ì“°ë ˆë“œê°€ ë‹¤ì‹œ ë‹¤ë¥¸ `lock`ì„ ëŒ€ê¸°í•˜ëŠë¼ `lock`ì„ ë°˜í™˜í•˜ì§€ ëª»í•˜ëŠ” ìƒí™©ì—ì„œ ë°œìƒí•œë‹¤

![](images/deadlock.png)
* ìœ„ ì´ë¯¸ì§€ëŠ” ë‘ ì“°ë ˆë“œ `P`, `Q`ê°€ ê°ê° ìì› `A`ì™€ `B`ë¥¼ ì–»ê³  ë°˜í™˜í•˜ëŠ” ìˆœì„œì— ë”°ë¼ ë°ë“œë½ì´ ë°œìƒí•  ìˆ˜ ìˆëŠ” ê²½ìš°ì˜ ìˆ˜ë¥¼ í‘œí˜„í•œ ê²ƒì´ë‹¤
* ê° ì“°ë ˆë“œê°€ ì°¨ë¡€ë¡œ ë‘ ìì›ì„ ì–»ê³  ë°˜í™˜í•˜ëŠ” `1, 2, 5, 6`ë²ˆ ì‹œë‚˜ë¦¬ì˜¤ëŠ” ë°ë“œë½ì´ ë°œìƒí•˜ì§€ ì•Šì§€ë§Œ
  * `3, 4`ë²ˆ ì‹œë‚˜ë¦¬ì˜¤ëŒ€ë¡œ í•œ ì“°ë ˆë“œê°€ `A` ìì›ì„ ì–»ì€ ìƒíƒœì—ì„œ ë‹¤ë¥¸ ì“°ë ˆë“œë„ `B` ìì›ì„ íšë“í•˜ê³  **ì„œë¡œ í•´ë‹¹ ìì›ì„ ë°˜í™˜í•˜ê¸° ì „ì— ì„œë¡œì˜ ìì›ì„ ì›í•˜ëŠ” ê²½ìš°** ë°ë“œë½ì„ í”¼í•  ìˆ˜ ì—†ë‹¤

## ì¶”ê°€ ì •ë¦¬ (ì§ˆë¬¸)
1. ì“°ë ˆë“œê°€ ì œê³µí•˜ëŠ” ë©”ì„œë“œë“¤
   1. `join()`, `interrupt()`, `currentThread()`, ...
   2. `Thread.stop()` ì´ ì—†ëŠ” ì´ìœ ëŠ” í•´ë‹¹ ì“°ë ˆë“œê°€ ë“¤ê³  ìˆë˜ ë½ì´ í’€ë¦¬ê±°ë‚˜ ê°’ì´ ê¼¬ì´ëŠ” ë“± ë³µì¡í•œ ë¬¸ì œê°€ ë°œìƒí•˜ë¯€ë¡œ ì‹œìŠ¤í…œ ë ˆë²¨ì—ì„œ ì“°ë ˆë“œë¥¼ ì¢…ë£Œí•˜ë©´ ì•ˆ ëœë‹¤, ì“°ë ˆë“œì˜ ì¢…ë£ŒëŠ” ê°œë°œìê°€ ì§ì ‘ í•´ë‹¹ ì“°ë ˆë“œì˜ ìƒíƒœë¥¼ ë³´ê³  ì²˜ë¦¬í•´ì•¼ í•œë‹¤. (ì´ëŸ¬í•œ ì´ìœ ë¡œ deprecatedë¨)
2.  ì“°ë ˆë“œ ìƒíƒœ ê´€ë ¨ ë³´ì¶© í•™ìŠµ
   1. Objectì˜ `wait()` ë“± ë©”ì„œë“œì™€ ì“°ë ˆë“œ ìƒíƒœì˜ ê´€ê²Œ
3. ì“°ë ˆë“œì—ì„œ `ëª¨ë‹ˆí„°`ë€?
4. `ConcurrnetHashMap`?
   1. `HashMap` ì€ ë™ê¸°í™” ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆìŒ. `HashTable`ì€ ë™ê¸°í™” ë¬¸ì œê°€ ë°œìƒí•˜ì§€ ì•Šì§€ë§Œ ì„±ëŠ¥ì´ ëŠë¦¼.
   2. `ConcurrnetHashMap` ì€ ì½ê¸°ëŠ” ë™ê¸°í™” ë¬¸ì œë¥¼ ê³ ë ¤ X, ì“°ê¸° ì‘ì—…ë§Œ ê³ ë ¤í•˜ì—¬ ëŒ€ì•ˆì„ ì œê³µ
5. `synchronized`ëŠ” ë¸”ëŸ­ì— ë“¤ì–´ê°€ê¸° ì „, `CPU Cache`ì™€ `Main Memory` ë™ê¸°í™”ë¥¼ ìˆ˜í–‰í•˜ë‚˜?
6. ë©”ì¸ ì“°ë ˆë“œ - (ì‚¬ì§„) ë„£ì–´ì•¼ëŒ
7. `start()` ì‹œ ì“°ë ˆë“œì™€ Stackì´ ìƒì„±ë˜ëŠ”ê°€?
8.  ë©€í‹° ì“°ë ˆë“œëŠ” ì–´ë–¤ ìƒí™©ì— ì“°ëŠ”ê°€?
    1.  ì›¹ ìš”ì²­ ì“°ë ˆë“œê³¼ ê°™ì´ ì—¬ëŸ¬ ë³‘ë ¬ ìš”ì²­ì„ ë™ì‹œì— ì²˜ë¦¬í•´ì•¼ í•  ë•Œ, ì„œë²„ì˜ ì„±ëŠ¥ì„ ê·¹í•œìœ¼ë¡œ ì“¸ ìˆ˜ ìˆê²Œ í•´ì£¼ê³  ê° ì“°ë ˆë“œ (ìš”ì²­)ì˜ ëŒ€ê¸° ì‹œê°„ì„ ì¤„ì—¬ì¤„ ìˆ˜ ìˆë‹¤
9.  `volatile`ì€ í•­ìƒ ìµœì‹  ê°’ì„ ë©”ëª¨ë¦¬ì—ì„œ ë¶ˆëŸ¬ì˜¤ëŠ” ê²ƒë§Œ ë³´ì¥í•˜ê¸° ë•Œë¬¸ì— í•œ ì“°ë ˆë“œë§Œ ì“°ê¸° ì‘ì—…ì„ í•  ë•Œ ì˜ë¯¸ê°€ ìˆë‹¤.
   1. ì¦‰, ì—¬ëŸ¬ ì“°ë ˆë“œì—ì„œ í•˜ë‚˜ì˜ ë³€ìˆ˜ì— ëŒ€í•˜ì—¬ ì“°ê¸° ì‘ì—…ì„ í•  ë•Œ ì›ìì„±ì„ ë³´ì¥í•˜ì§„ ì•ŠìŒ
   2. ë”°ë¼ì„œ ë©€í‹° ì“°ë ˆë“œ ì“°ê¸° ìƒí™©ì— ì›ìì„±ê¹Œì§€ ë³´ì¥í•˜ë ¤ë©´ `Atomic`ë„ ë™ì‹œì— ì‚¬ìš©í•´ì•¼ í•¨
   3. ì´ëŸ° ìƒí™©ì´ ë“œë¯ˆê¸° ë•Œë¬¸ì— `volatile`ì€ ì˜ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤
10. ë©€í‹°ì“°ë ˆë“œ í”„ë¡œê·¸ë˜ë° ì˜ˆì œ
    1.  `ExecutorService`
    2.  `CountDownLatch`
11. ë³‘ë ¬ì„±(Parallelism, ì‹¤ì œë¡œ ë™ì‹œì— ìˆ˜í–‰) vs ë™ì‹œì„±(Concurrency, context switching)
12. synchronized
    1.  ë™ê¸°í™” ë¸”ëŸ­ -> ê³µìœ  ê°ì²´ë¥¼ ì§€ì •í•  ìˆ˜ ìˆê³  ë²”ìœ„ë¥¼ ì¤„ì¼ ìˆ˜ ìˆì–´ì„œ ë” ë§ì´ ì‚¬ìš©
13. Critical Path
    1.  ë™ì‹œì— ì‹¤í–‰ëœ ì“°ë ˆë“œ ì¤‘ì— ê°€ì¥ ì˜¤ë˜ê±¸ë¦¬ëŠ” ì‘ì—…ë“¤ì˜ Path
    2.  ë‹¤ë¥¸ ì“°ë ˆë“œë³´ë‹¤ critical pathì˜ ì“°ë ˆë“œ ë¡œì§ì„ ê°œì„ í•˜ëŠ”ê²Œ ë” ì˜ë¯¸ìˆë‹¤
    3.  ì „ì²´ ì‹¤í–‰ ì‹œê°„ì— ì§ì ‘ì ìœ¼ë¡œ ì˜í–¥ì„ ë¯¸ì¹˜ëŠ” ì“°ë ˆë“œë“¤
14. Thread dump
    1.  í˜„ì¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì‹¤í–‰ ì¤‘ì¸ Threadì™€ ë°ë“œë½ ë°œìƒ ìœ ë¬´, ë½ ê°ì²´ ë“± í™•ì¸ê°€ëŠ¥
    2.  Visual VMìœ¼ë¡œ ê°€ëŠ¥
15. Heap Dump
    1.  ë©”ëª¨ë¦¬ë¥¼ ìŠ¤ëƒ…ìƒ·
    2.  ì„œë²„ ë©”ëª¨ë¦¬ë³´ë‹¤ ë¡œì»¬ ë©”ëª¨ë¦¬ê°€ ë” ë§ì•„ì•¼ heap ë¶„ì„ ê°€ëŠ¥
16. 

## í”¼ë“œë°±
* 


## ì°¸ê³ ìë£Œ
* https://www.notion.so/Thread-5fdb5d603a6a473186bf2738f482cedc
* https://sujl95.tistory.com/63
* https://gyoogle.dev/blog/computer-science/operating-system/Process%20vs%20Thread.html
* https://widevery.tistory.com/27
* https://wisdom-and-record.tistory.com/48
* 